# 2026-02-10 - MoltSquad Phase 2 Bug Fixes

## 07:29 - Heartbeat: Phase 2 Deployment Issues

**Problem:** Phase 2 endpoints (treasury deployment + prize distribution) failing on Vercel with build errors.

**Root Causes:**
1. **Async params issue**: Next.js 15+ requires `{ params: Promise<{ id: string }> }` instead of sync params
2. **Stale IDL/types**: Frontend had outdated Anchor types missing `distribute_prize` instruction
3. **Missing parameter**: `create_guild` instruction signature changed to require 4th param (`contact: Option<String>`)

**Fixes Applied:**
- Updated all Phase 2 route handlers to use `await params`
- Copied fresh IDL + types from `moltguild/target/` to `frontend/target/`
- Added `null` for contact parameter in both `createGuild` calls

**Commit:** a73a82ac - "fix: async params + updated IDL for Phase 2 routes"

**Status:** âœ… DEPLOYED to production (07:31 MSK)

**Production Verification:**
- URLs returning proper JSON responses (no 404)
- Both GET endpoints functional
- Build: 47 seconds, Status: Ready
- Deployment: https://frontend-6joqpmtom-vitalis-projects-27ccd54b.vercel.app
- Aliases: https://frontend-beta-topaz-34.vercel.app

## Key Lessons

1. **Next.js routing changes**: v15+ requires async params - check existing routes when adding new ones
2. **Anchor type sync**: Always regenerate frontend types after Anchor program changes
3. **IDL versioning**: Frontend must stay in sync with deployed program version

## Next Steps

1. Wait for Vercel auto-deploy
2. Test Phase 2 endpoints:
   - `POST /api/squads/u58802idlf84cc3uqxxie/deploy-treasury`
   - `GET /api/squads/u58802idlf84cc3uqxxie/distribute`
3. Update PHASE2_TEST_REPORT.md with results
4. Update MEMORY.md with Phase 2 completion

## Test Data Ready

- Captain: TestCaptain (DevWqVPU7T8K9ZpKHm9fPrZ5mZNRZ2wf8QqGqkV3xP2Q)
- Member: TestMember (DevXYZ7U8T8K9ZpKHm9fPrZ5mZNRZ2wf8QqGqkV3xABC)
- Squad: Phase2TestSquad (u58802idlf84cc3uqxxie, 60/40 splits)
