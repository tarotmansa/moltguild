# 2026-02-10

## 16:12 - Moltbook-Style Toggle Complete üé®

Vitali pointed out our toggle wasn't showing **different content** like Moltbook does. Fixed:

**Changes Made:**
- **Red "I'm a Human" state**: "Send Your AI Agent to MoltSquad" + human-focused steps
- **Green "I'm an Agent" state**: "Join MoltSquad" + direct curl command + agent-focused steps
- Border colors match active state (red/green)
- Content completely changes based on toggle (not just styling)

**Updated Documentation:**
- Updated `docs/user-journey-visual.html` to reflect GitHub OAuth claim flow
- Fixed agent onboarding phases (skill.md ‚Üí register ‚Üí claim code ‚Üí GitHub ‚Üí proceed)
- Removed old wallet connect references
- All references now point to production URLs

**Deployments:**
- Commit f918a0d1: Moltbook-style toggle
- Commit 8a606933: User journey docs
- Production: https://frontend-beta-topaz-34.vercel.app (deployed 16:15 MSK)

**Key Insight:** Moltbook's toggle isn't just visual - it's a complete content switch for different audiences. Now MoltSquad matches that UX pattern exactly.

---

## 16:45 - Critical Architecture Fixes üîß

Vitali identified 3 critical issues with MoltSquad design:

**1. gigId Required (FIXED)**
- Problem: Blocked general-purpose squads
- Solution: Made gigId optional in squad creation
- Commit: 5ca2f488

**2. Treasury Timing (FIXED - CRITICAL)**
- Problem: Treasury deployed AFTER winning (prize could arrive before ready)
- Solution: Auto-deploy treasury PDA immediately on squad creation
- Treasury address returned in creation response
- Ready for hackathon payout BEFORE win
- Commits: 5ca2f488, 20474f35 (type fix)

**3. Collaboration Mechanism (IDENTIFIED - NOT YET FIXED)**
- Problem: Discord/TG links don't work for AI agents
- Current: Agents can't actually coordinate (blocking issue)
- Proposed solutions:
  - **Option A (RECOMMENDED):** TG group per squad (agents message via Bot API)
  - **Option B:** GitHub team + repo per gig (for code projects)
  - **Option C:** Built-in chat API (most work)
- **Recommendation:** Hybrid (TG for chat + GitHub for code)
- **Impact:** Without this, squads can't collaborate
- **Status:** Documented in proactive-ideas.md, implementation pending

**Key Insight:** MoltSquad is currently a "squad registry + prize splitter" but missing the actual collaboration layer. Treasury timing fix ensures funds can be received immediately after win.

--- - MoltSquad Phase 2 Bug Fixes

## 07:29 - Heartbeat: Phase 2 Deployment Issues

**Problem:** Phase 2 endpoints (treasury deployment + prize distribution) failing on Vercel with build errors.

**Root Causes:**
1. **Async params issue**: Next.js 15+ requires `{ params: Promise<{ id: string }> }` instead of sync params
2. **Stale IDL/types**: Frontend had outdated Anchor types missing `distribute_prize` instruction
3. **Missing parameter**: `create_guild` instruction signature changed to require 4th param (`contact: Option<String>`)

**Fixes Applied:**
- Updated all Phase 2 route handlers to use `await params`
- Copied fresh IDL + types from `moltguild/target/` to `frontend/target/`
- Added `null` for contact parameter in both `createGuild` calls

**Commit:** a73a82ac - "fix: async params + updated IDL for Phase 2 routes"

**Status:** ‚úÖ DEPLOYED to production (07:31 MSK)

**Production Verification:**
- URLs returning proper JSON responses (no 404)
- Both GET endpoints functional
- Build: 47 seconds, Status: Ready
- Deployment: https://frontend-6joqpmtom-vitalis-projects-27ccd54b.vercel.app
- Aliases: https://frontend-beta-topaz-34.vercel.app

## Key Lessons

1. **Next.js routing changes**: v15+ requires async params - check existing routes when adding new ones
2. **Anchor type sync**: Always regenerate frontend types after Anchor program changes
3. **IDL versioning**: Frontend must stay in sync with deployed program version

## Next Steps

1. Wait for Vercel auto-deploy
2. Test Phase 2 endpoints:
   - `POST /api/squads/u58802idlf84cc3uqxxie/deploy-treasury`
   - `GET /api/squads/u58802idlf84cc3uqxxie/distribute`
3. Update PHASE2_TEST_REPORT.md with results
4. Update MEMORY.md with Phase 2 completion

## Test Data Ready

- Captain: TestCaptain (DevWqVPU7T8K9ZpKHm9fPrZ5mZNRZ2wf8QqGqkV3xP2Q)
- Member: TestMember (DevXYZ7U8T8K9ZpKHm9fPrZ5mZNRZ2wf8QqGqkV3xABC)
- Squad: Phase2TestSquad (u58802idlf84cc3uqxxie, 60/40 splits)

## 09:36 - Phase 4: Frontend Updated to API-First

**Achievement:** Completed Phase 4 - frontend now fully agents-only (browse/discovery)

**Changes Made:**
1. **Replaced `/squads/new` form** ‚Üí API instructions page
   - Shows curl example for creating squads
   - Links to skill.md documentation
   - Emphasizes instant, no-wallet creation

2. **Updated `/squads/[id]` detail page**
   - Added "Join this Squad" API instructions section
   - Shows curl example for joining
   - Prominent link to full API documentation

3. **Verified existing pages** already API-first:
   - `/agents` - ‚úÖ Fetches from `/api/agents/list`
   - `/agents/[id]` - ‚úÖ Fetches from `/api/agents/[id]`
   - `/squads` - ‚úÖ Fetches from `/api/squads/list`
   - `/squads/[id]` - ‚úÖ Fetches from `/api/squads/[id]`

**Frontend Architecture:**
- **Read-only UI** for humans/agents to browse
- **No forms** for profile/squad creation
- **API instructions** prominently displayed
- **skill.md links** throughout

**Status:** ‚úÖ Phase 4 COMPLETE
**Commit:** ed6b4e7a - "feat: Phase 4 complete - frontend updated to API-first (agents-only)"
**Build:** Passing (28 routes, all green)

## MoltSquad Status Summary (09:36 MSK)

**Phases Complete:**
- ‚úÖ Phase 1: Off-chain APIs (11 routes)
- ‚úÖ Phase 2: On-chain treasury (deployed to production)
- ‚ùå Phase 3: GitHub OAuth (skipped - not needed for agents-only)
- ‚úÖ Phase 4: Frontend to read-only (just completed)
- ‚úÖ Phase 5: skill.md v3.0.0

**Remaining:**
- Demo video (manual recording task)
- Optional polish/improvements

**Time to Deadline:** 2.4 days

## 23:05 - Upstash Redis Persistence Added ‚úÖ

**Request:** Add $0 persistence, Vercel-compatible; chose Upstash Redis.

**Actions:**
- Integrated `@upstash/redis` storage layer (fallback to in-memory)
- Made all storage functions async; updated API routes accordingly
- Added `getAgentSquads` via membership scan
- Set Vercel env vars for Upstash (no trailing newlines)
- Deployed to production and validated

**Tests (prod):**
- Created agent profile ‚úÖ
- Created squad ‚úÖ
- Listed agents ‚úÖ

**Commit:** 35a5133b
**Live:** https://frontend-beta-topaz-34.vercel.app
